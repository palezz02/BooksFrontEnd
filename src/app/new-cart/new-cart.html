<div class="cart-page" *ngIf="cartItems$ | async as cartItems">
  <!-- Empty cart -->
  <div *ngIf="cartItems.length === 0" class="empty-cart">
    <mat-icon class="empty-icon">shopping_cart</mat-icon>
    <h2>Your cart is empty</h2>
    <p>Add some books to get started!</p>
  </div>

  <!-- Cart items -->
  <mat-card *ngIf="cartItems.length > 0" class="cart-card">
    <div class="cart-header">
      <h3>Your Cart ({{ getQuantity(cartItems) }} items)</h3>
    </div>

    <div class="cart-items" *ngFor="let item of cartItems">
      <div>
        <img
          mat-card-image
          [src]="item.coverImage || 'assets/default-book-cover.jpg'"
          [alt]="item.title"
          class="cart-image"
        />
      </div>
      <div class="item-details">
        <div class="top-item">
          <div>
            <h2>{{ item.title }}</h2>
            <p>
              <span>ISBN: {{ item.isbn }}</span>
              <span> • {{ item.pageCount }} pages</span>
              <span> • {{ item.languageCode }}</span>
            </p>
            <p class="book-description">{{ item.description }}</p>
            <p class="stock-info"><span>{{ item.stock }} in stock</span></p>
          </div>
          <div>
            <button mat-icon-button color="warn" (click)="removeItem(item)">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
        <div class="quantity-control">
          <p>{{ item.unitPrice | currency : 'EUR' }} each</p>
          <div class="quantity">
            <button mat-icon-button (click)="removeQuantity(item)">
              <mat-icon>remove</mat-icon>
            </button>
            <span>{{ item.quantity }}</span>
            <button mat-icon-button (click)="addQuantity(item)">
              <mat-icon>add</mat-icon>
            </button>
          </div>
          <p class="subtotal">{{ item.subtotal | currency : 'EUR' }}</p>
        </div>
      </div>
    </div>
  </mat-card>

  <!-- Price details -->
  <mat-card *ngIf="cartItems.length > 0" class="price-details-card">
    <mat-card-header>
      <mat-card-title>Price Details</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-list>
        <mat-list-item>
          <div class="item-title">{{ getQuantity(cartItems) }} items</div>
        </mat-list-item>
        <mat-list-item *ngFor="let item of cartItems">
          <div class="list-item-content">
            <div class="item-name">{{ item.quantity }} x {{ item.title }}</div>
            <div class="item-price">
              <p>{{ item.subtotal | currency : 'EUR' }}</p>
            </div>
          </div>
        </mat-list-item>
      </mat-list>
      <div class="total-amount-row">
        <div class="total-amount-label">Total Amount</div>
        <div class="total-amount-price">{{ getTotal(cartItems) | currency : 'EUR' }}</div>
      </div>
    </mat-card-content>
    <button mat-flat-button color="accent" class="place-order-button" (click)="placeOrder(cartItems)">
      <p>
        <span>Place order</span>
        <mat-icon>arrow_forward</mat-icon>
      </p>
    </button>
  </mat-card>
</div>
